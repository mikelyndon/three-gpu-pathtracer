var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},n={},i=e.parcelRequire5b70;null==i&&((i=function(e){if(e in t)return t[e].exports;if(e in n){var i=n[e];delete n[e];var o={id:e,exports:{}};return t[e]=o,i.call(o.exports,o,o.exports),o.exports}var a=new Error("Cannot find module '"+e+"'");throw a.code="MODULE_NOT_FOUND",a}).register=function(e,t){n[e]=t},e.parcelRequire5b70=i);var o=i("ilwiq"),a=i("RPVlj"),s=i("5Rd1x"),r=i("4CEV9"),h=i("cVdfP"),l=i("891vQ"),c=i("jiuw3");const d=new((o=i("ilwiq")).Raycaster),p=new o.Vector3,m=new o.Vector3,u=new o.Quaternion,w={X:new o.Vector3(1,0,0),Y:new o.Vector3(0,1,0),Z:new o.Vector3(0,0,1)},y={type:"change"},g={type:"mouseDown"},M={type:"mouseUp",mode:null},b={type:"objectChange"};class v extends o.Object3D{constructor(e,t){super(),void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.isTransformControls=!0,this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const n=new V;this._gizmo=n,this.add(n);const i=new k;this._plane=i,this.add(i);const a=this;function s(e,t){let o=t;Object.defineProperty(a,e,{get:function(){return void 0!==o?o:t},set:function(t){o!==t&&(o=t,i[e]=t,n[e]=t,a.dispatchEvent({type:e+"-changed",value:t}),a.dispatchEvent(y))}}),a[e]=t,i[e]=t,n[e]=t}s("camera",e),s("object",void 0),s("enabled",!0),s("axis",null),s("mode","translate"),s("translationSnap",null),s("rotationSnap",null),s("scaleSnap",null),s("space","world"),s("size",1),s("dragging",!1),s("showX",!0),s("showY",!0),s("showZ",!0);const r=new o.Vector3,h=new o.Vector3,l=new o.Quaternion,c=new o.Quaternion,d=new o.Vector3,p=new o.Quaternion,m=new o.Vector3,u=new o.Vector3,w=new o.Vector3,g=new o.Vector3;s("worldPosition",r),s("worldPositionStart",h),s("worldQuaternion",l),s("worldQuaternionStart",c),s("cameraPosition",d),s("cameraQuaternion",p),s("pointStart",m),s("pointEnd",u),s("rotationAxis",w),s("rotationAngle",0),s("eye",g),this._offset=new o.Vector3,this._startNorm=new o.Vector3,this._endNorm=new o.Vector3,this._cameraScale=new o.Vector3,this._parentPosition=new o.Vector3,this._parentQuaternion=new o.Quaternion,this._parentQuaternionInv=new o.Quaternion,this._parentScale=new o.Vector3,this._worldScaleStart=new o.Vector3,this._worldQuaternionInv=new o.Quaternion,this._worldScale=new o.Vector3,this._positionStart=new o.Vector3,this._quaternionStart=new o.Quaternion,this._scaleStart=new o.Vector3,this._getPointer=x.bind(this),this._onPointerDown=P.bind(this),this._onPointerHover=f.bind(this),this._onPointerMove=S.bind(this),this._onPointerUp=E.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;d.setFromCamera(e,this.camera);const t=_(this._gizmo.picker[this.mode],d);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){d.setFromCamera(e,this.camera);const t=_(this._plane,d,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,g.mode=this.mode,this.dispatchEvent(g)}}pointerMove(e){const t=this.axis,n=this.mode,i=this.object;let o=this.space;if("scale"===n?o="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(o="world"),void 0===i||null===t||!1===this.dragging||-1!==e.button)return;d.setFromCamera(e,this.camera);const a=_(this._plane,d,!0);if(a){if(this.pointEnd.copy(a.point).sub(this.worldPositionStart),"translate"===n)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===o&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===o&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),i.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===o&&(i.position.applyQuaternion(u.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.position.applyQuaternion(this._quaternionStart)),"world"===o&&(i.parent&&i.position.add(p.setFromMatrixPosition(i.parent.matrixWorld)),-1!==t.search("X")&&(i.position.x=Math.round(i.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(i.position.y=Math.round(i.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(i.position.z=Math.round(i.position.z/this.translationSnap)*this.translationSnap),i.parent&&i.position.sub(p.setFromMatrixPosition(i.parent.matrixWorld))));else if("scale"===n){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),m.set(e,e,e)}else p.copy(this.pointStart),m.copy(this.pointEnd),p.applyQuaternion(this._worldQuaternionInv),m.applyQuaternion(this._worldQuaternionInv),m.divide(p),-1===t.search("X")&&(m.x=1),-1===t.search("Y")&&(m.y=1),-1===t.search("Z")&&(m.z=1);i.scale.copy(this._scaleStart).multiply(m),this.scaleSnap&&(-1!==t.search("X")&&(i.scale.x=Math.round(i.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(i.scale.y=Math.round(i.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(i.scale.z=Math.round(i.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===n){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(p.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(p.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(w[t]),p.copy(w[t]),"local"===o&&p.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(p.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===o&&"E"!==t&&"XYZE"!==t?(i.quaternion.copy(this._quaternionStart),i.quaternion.multiply(u.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),i.quaternion.copy(u.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),i.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(y),this.dispatchEvent(b)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&(M.mode=this.mode,this.dispatchEvent(M)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((function(e){e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(y),this.dispatchEvent(b),this.pointStart.copy(this.pointEnd))}getRaycaster(){return d}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}function x(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};{const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}}function f(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function P(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function S(e){this.enabled&&this.pointerMove(this._getPointer(e))}function E(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function _(e,t,n){const i=t.intersectObject(e,!0);for(let e=0;e<i.length;e++)if(i[e].object.visible||n)return i[e];return!1}const I=new o.Euler,C=new o.Vector3(0,1,0),L=new o.Vector3(0,0,0),Q=new o.Matrix4,G=new o.Quaternion,A=new o.Quaternion,X=new o.Vector3,Y=new o.Matrix4,F=new o.Vector3(1,0,0),Z=new o.Vector3(0,1,0),T=new o.Vector3(0,0,1),z=new o.Vector3,j=new o.Vector3,B=new o.Vector3;class V extends o.Object3D{constructor(){super(),this.isTransformControlsGizmo=!0,this.type="TransformControlsGizmo";const e=new o.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new o.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),n=e.clone();n.opacity=.15;const i=t.clone();i.opacity=.5;const a=e.clone();a.color.setHex(16711680);const s=e.clone();s.color.setHex(65280);const r=e.clone();r.color.setHex(255);const h=e.clone();h.color.setHex(16711680),h.opacity=.5;const l=e.clone();l.color.setHex(65280),l.opacity=.5;const c=e.clone();c.color.setHex(255),c.opacity=.5;const d=e.clone();d.opacity=.25;const p=e.clone();p.color.setHex(16776960),p.opacity=.25;e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const u=new o.CylinderGeometry(0,.04,.1,12);u.translate(0,.05,0);const w=new o.BoxGeometry(.08,.08,.08);w.translate(0,.04,0);const y=new o.BufferGeometry;y.setAttribute("position",new o.Float32BufferAttribute([0,0,0,1,0,0],3));const g=new o.CylinderGeometry(.0075,.0075,.5,3);function M(e,t){const n=new o.TorusGeometry(e,.0075,3,64,t*Math.PI*2);return n.rotateY(Math.PI/2),n.rotateX(Math.PI/2),n}g.translate(0,.25,0);const b={X:[[new o.Mesh(u,a),[.5,0,0],[0,0,-Math.PI/2]],[new o.Mesh(u,a),[-.5,0,0],[0,0,Math.PI/2]],[new o.Mesh(g,a),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new o.Mesh(u,s),[0,.5,0]],[new o.Mesh(u,s),[0,-.5,0],[Math.PI,0,0]],[new o.Mesh(g,s)]],Z:[[new o.Mesh(u,r),[0,0,.5],[Math.PI/2,0,0]],[new o.Mesh(u,r),[0,0,-.5],[-Math.PI/2,0,0]],[new o.Mesh(g,r),null,[Math.PI/2,0,0]]],XYZ:[[new o.Mesh(new o.OctahedronGeometry(.1,0),d.clone()),[0,0,0]]],XY:[[new o.Mesh(new o.BoxGeometry(.15,.15,.01),c.clone()),[.15,.15,0]]],YZ:[[new o.Mesh(new o.BoxGeometry(.15,.15,.01),h.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new o.Mesh(new o.BoxGeometry(.15,.15,.01),l.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},v={X:[[new o.Mesh(new o.CylinderGeometry(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new o.Mesh(new o.CylinderGeometry(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new o.Mesh(new o.CylinderGeometry(.2,0,.6,4),n),[0,.3,0]],[new o.Mesh(new o.CylinderGeometry(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new o.Mesh(new o.CylinderGeometry(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new o.Mesh(new o.CylinderGeometry(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new o.Mesh(new o.OctahedronGeometry(.2,0),n)]],XY:[[new o.Mesh(new o.BoxGeometry(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new o.Mesh(new o.BoxGeometry(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new o.Mesh(new o.BoxGeometry(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]]},x={START:[[new o.Mesh(new o.OctahedronGeometry(.01,2),i),null,null,null,"helper"]],END:[[new o.Mesh(new o.OctahedronGeometry(.01,2),i),null,null,null,"helper"]],DELTA:[[new o.Line(function(){const e=new o.BufferGeometry;return e.setAttribute("position",new o.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),i),null,null,null,"helper"]],X:[[new o.Line(y,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new o.Line(y,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new o.Line(y,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},f={XYZE:[[new o.Mesh(M(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new o.Mesh(M(.5,.5),a)]],Y:[[new o.Mesh(M(.5,.5),s),null,[0,0,-Math.PI/2]]],Z:[[new o.Mesh(M(.5,.5),r),null,[0,Math.PI/2,0]]],E:[[new o.Mesh(M(.75,1),p),null,[0,Math.PI/2,0]]]},P={AXIS:[[new o.Line(y,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},S={XYZE:[[new o.Mesh(new o.SphereGeometry(.25,10,8),n)]],X:[[new o.Mesh(new o.TorusGeometry(.5,.1,4,24),n),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new o.Mesh(new o.TorusGeometry(.5,.1,4,24),n),[0,0,0],[Math.PI/2,0,0]]],Z:[[new o.Mesh(new o.TorusGeometry(.5,.1,4,24),n),[0,0,0],[0,0,-Math.PI/2]]],E:[[new o.Mesh(new o.TorusGeometry(.75,.1,2,24),n)]]},E={X:[[new o.Mesh(w,a),[.5,0,0],[0,0,-Math.PI/2]],[new o.Mesh(g,a),[0,0,0],[0,0,-Math.PI/2]],[new o.Mesh(w,a),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new o.Mesh(w,s),[0,.5,0]],[new o.Mesh(g,s)],[new o.Mesh(w,s),[0,-.5,0],[0,0,Math.PI]]],Z:[[new o.Mesh(w,r),[0,0,.5],[Math.PI/2,0,0]],[new o.Mesh(g,r),[0,0,0],[Math.PI/2,0,0]],[new o.Mesh(w,r),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new o.Mesh(new o.BoxGeometry(.15,.15,.01),c),[.15,.15,0]]],YZ:[[new o.Mesh(new o.BoxGeometry(.15,.15,.01),h),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new o.Mesh(new o.BoxGeometry(.15,.15,.01),l),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new o.Mesh(new o.BoxGeometry(.1,.1,.1),d.clone())]]},_={X:[[new o.Mesh(new o.CylinderGeometry(.2,0,.6,4),n),[.3,0,0],[0,0,-Math.PI/2]],[new o.Mesh(new o.CylinderGeometry(.2,0,.6,4),n),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new o.Mesh(new o.CylinderGeometry(.2,0,.6,4),n),[0,.3,0]],[new o.Mesh(new o.CylinderGeometry(.2,0,.6,4),n),[0,-.3,0],[0,0,Math.PI]]],Z:[[new o.Mesh(new o.CylinderGeometry(.2,0,.6,4),n),[0,0,.3],[Math.PI/2,0,0]],[new o.Mesh(new o.CylinderGeometry(.2,0,.6,4),n),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new o.Mesh(new o.BoxGeometry(.2,.2,.01),n),[.15,.15,0]]],YZ:[[new o.Mesh(new o.BoxGeometry(.2,.2,.01),n),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new o.Mesh(new o.BoxGeometry(.2,.2,.01),n),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new o.Mesh(new o.BoxGeometry(.2,.2,.2),n),[0,0,0]]]},I={X:[[new o.Line(y,i.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new o.Line(y,i.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new o.Line(y,i.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function C(e){const t=new o.Object3D;for(const n in e)for(let i=e[n].length;i--;){const o=e[n][i][0].clone(),a=e[n][i][1],s=e[n][i][2],r=e[n][i][3],h=e[n][i][4];o.name=n,o.tag=h,a&&o.position.set(a[0],a[1],a[2]),s&&o.rotation.set(s[0],s[1],s[2]),r&&o.scale.set(r[0],r[1],r[2]),o.updateMatrix();const l=o.geometry.clone();l.applyMatrix4(o.matrix),o.geometry=l,o.renderOrder=1/0,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),t.add(o)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=C(b)),this.add(this.gizmo.rotate=C(f)),this.add(this.gizmo.scale=C(E)),this.add(this.picker.translate=C(v)),this.add(this.picker.rotate=C(S)),this.add(this.picker.scale=C(_)),this.add(this.helper.translate=C(x)),this.add(this.helper.rotate=C(P)),this.add(this.helper.scale=C(I)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:A;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let n=[];n=n.concat(this.picker[this.mode].children),n=n.concat(this.gizmo[this.mode].children),n=n.concat(this.helper[this.mode].children);for(let e=0;e<n.length;e++){const i=n[e];let o;if(i.visible=!0,i.rotation.set(0,0,0),i.position.copy(this.worldPosition),o=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),i.scale.set(1,1,1).multiplyScalar(o*this.size/4),"helper"!==i.tag){if(i.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const e=.99,n=.2;"X"===i.name&&Math.abs(C.copy(F).applyQuaternion(t).dot(this.eye))>e&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Y"===i.name&&Math.abs(C.copy(Z).applyQuaternion(t).dot(this.eye))>e&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"Z"===i.name&&Math.abs(C.copy(T).applyQuaternion(t).dot(this.eye))>e&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XY"===i.name&&Math.abs(C.copy(T).applyQuaternion(t).dot(this.eye))<n&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"YZ"===i.name&&Math.abs(C.copy(F).applyQuaternion(t).dot(this.eye))<n&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1),"XZ"===i.name&&Math.abs(C.copy(Z).applyQuaternion(t).dot(this.eye))<n&&(i.scale.set(1e-10,1e-10,1e-10),i.visible=!1)}else"rotate"===this.mode&&(G.copy(t),C.copy(this.eye).applyQuaternion(u.copy(t).invert()),-1!==i.name.search("E")&&i.quaternion.setFromRotationMatrix(Q.lookAt(this.eye,L,Z)),"X"===i.name&&(u.setFromAxisAngle(F,Math.atan2(-C.y,C.z)),u.multiplyQuaternions(G,u),i.quaternion.copy(u)),"Y"===i.name&&(u.setFromAxisAngle(Z,Math.atan2(C.x,C.z)),u.multiplyQuaternions(G,u),i.quaternion.copy(u)),"Z"===i.name&&(u.setFromAxisAngle(T,Math.atan2(C.y,C.x)),u.multiplyQuaternions(G,u),i.quaternion.copy(u)));i.visible=i.visible&&(-1===i.name.indexOf("X")||this.showX),i.visible=i.visible&&(-1===i.name.indexOf("Y")||this.showY),i.visible=i.visible&&(-1===i.name.indexOf("Z")||this.showZ),i.visible=i.visible&&(-1===i.name.indexOf("E")||this.showX&&this.showY&&this.showZ),i.material._color=i.material._color||i.material.color.clone(),i.material._opacity=i.material._opacity||i.material.opacity,i.material.color.copy(i.material._color),i.material.opacity=i.material._opacity,this.enabled&&this.axis&&(i.name===this.axis||this.axis.split("").some((function(e){return i.name===e})))&&(i.material.color.setHex(16776960),i.material.opacity=1)}else i.visible=!1,"AXIS"===i.name?(i.position.copy(this.worldPositionStart),i.visible=!!this.axis,"X"===this.axis&&(u.setFromEuler(I.set(0,0,0)),i.quaternion.copy(t).multiply(u),Math.abs(C.copy(F).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Y"===this.axis&&(u.setFromEuler(I.set(0,0,Math.PI/2)),i.quaternion.copy(t).multiply(u),Math.abs(C.copy(Z).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"Z"===this.axis&&(u.setFromEuler(I.set(0,Math.PI/2,0)),i.quaternion.copy(t).multiply(u),Math.abs(C.copy(T).applyQuaternion(t).dot(this.eye))>.9&&(i.visible=!1)),"XYZE"===this.axis&&(u.setFromEuler(I.set(0,Math.PI/2,0)),C.copy(this.rotationAxis),i.quaternion.setFromRotationMatrix(Q.lookAt(L,C,Z)),i.quaternion.multiply(u),i.visible=this.dragging),"E"===this.axis&&(i.visible=!1)):"START"===i.name?(i.position.copy(this.worldPositionStart),i.visible=this.dragging):"END"===i.name?(i.position.copy(this.worldPosition),i.visible=this.dragging):"DELTA"===i.name?(i.position.copy(this.worldPositionStart),i.quaternion.copy(this.worldQuaternionStart),p.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),p.applyQuaternion(this.worldQuaternionStart.clone().invert()),i.scale.copy(p),i.visible=this.dragging):(i.quaternion.copy(t),this.dragging?i.position.copy(this.worldPositionStart):i.position.copy(this.worldPosition),this.axis&&(i.visible=-1!==this.axis.search(i.name)))}super.updateMatrixWorld(e)}}class k extends o.Mesh{constructor(){super(new o.PlaneGeometry(1e5,1e5,2,2),new o.MeshBasicMaterial({visible:!1,wireframe:!0,side:o.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.isTransformControlsPlane=!0,this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),z.copy(F).applyQuaternion("local"===t?this.worldQuaternion:A),j.copy(Z).applyQuaternion("local"===t?this.worldQuaternion:A),B.copy(T).applyQuaternion("local"===t?this.worldQuaternion:A),C.copy(j),this.mode){case"translate":case"scale":switch(this.axis){case"X":C.copy(this.eye).cross(z),X.copy(z).cross(C);break;case"Y":C.copy(this.eye).cross(j),X.copy(j).cross(C);break;case"Z":C.copy(this.eye).cross(B),X.copy(B).cross(C);break;case"XY":X.copy(B);break;case"YZ":X.copy(z);break;case"XZ":C.copy(B),X.copy(j);break;case"XYZ":case"E":X.set(0,0,0)}break;default:X.set(0,0,0)}0===X.length()?this.quaternion.copy(this.cameraQuaternion):(Y.lookAt(p.set(0,0,0),X,C),this.quaternion.setFromRotationMatrix(Y)),super.updateMatrixWorld(e)}}var q=i("7lx9d"),W=i("kp7Te");let R,H,O,D,U,N,$,J,K,ee,te;const ne={controls:!0,areaLight1Enabled:!0,areaLight2Enabled:!0,areaLight1Intensity:5,areaLight1Color:"#ffffff",areaLight1Width:1,areaLight1Height:1,areaLight2Intensity:20,areaLight2Color:"#ff0000",areaLight2Width:1.25,areaLight2Height:2.75,environmentIntensity:.1,environmentRotation:0,bounces:3,samplesPerFrame:1,resolutionScale:1/window.devicePixelRatio,filterGlossyFactor:.5,tiles:1,multipleImportanceSampling:!0};function ie(){U[0].intensity=ne.areaLight1Intensity,U[0].width=ne.areaLight1Width,U[0].height=ne.areaLight1Height,U[0].color.set(ne.areaLight1Color).convertSRGBToLinear(),U[1].intensity=ne.areaLight2Intensity,U[1].width=ne.areaLight2Width,U[1].height=ne.areaLight2Height,U[1].color.set(ne.areaLight2Color).convertSRGBToLinear();const e=[];ne.areaLight1Enabled&&e.push(U[0]),ne.areaLight2Enabled&&e.push(U[1]),$.material.lights.updateFrom(e),$.reset()}function oe(){const e=window.innerWidth,t=window.innerHeight,n=ne.resolutionScale,i=window.devicePixelRatio;$.setSize(e*n*i,t*n*i),$.reset(),R.setSize(e,t),R.setPixelRatio(window.devicePixelRatio*n),J.aspect=e/t,J.updateProjectionMatrix()}function ae(){requestAnimationFrame(ae),$.material.materials.updateFrom(N.materials,N.textures),$.material.filterGlossyFactor=ne.filterGlossyFactor,$.material.environmentIntensity=ne.environmentIntensity,$.material.environmentBlur=.35,$.material.bounces=ne.bounces,J.updateMatrixWorld();for(let e=0,t=ne.samplesPerFrame;e<t;e++)$.update();R.autoClear=!1,K.render(R),R.render(D,J),R.autoClear=!0,ee.innerText=`Samples: ${Math.floor($.samples)}`}window.innerWidth/window.innerHeight<.65&&(ne.bounces=Math.min(ne.bounces,10),ne.resolutionScale*=.5,ne.tiles=3),async function(){R=new o.WebGLRenderer({antialias:!0}),R.outputEncoding=o.sRGBEncoding,R.toneMapping=o.ACESFilmicToneMapping,document.body.appendChild(R.domElement),J=new o.PerspectiveCamera(75,window.innerWidth/window.innerHeight,.025,500),J.position.set(0,.6,2.65),$=new r.PathTracingRenderer(R),$.camera=J,$.material=new r.PhysicalPathTracingMaterial,$.tiles.set(ne.tiles,ne.tiles),K=new a.FullScreenQuad(new o.MeshBasicMaterial({map:$.target.texture})),H=new s.OrbitControls(J,R.domElement),H.target.set(0,.33,-.08),J.lookAt(H.target),H.addEventListener("change",(()=>{$.reset()})),H.update(),J.lookAt(-.15,.33,-.08),ee=document.getElementById("samples"),te=document.getElementById("loading");const e=(new l.RGBELoader).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/master/hdri/leadenhall_market_1k.hdr").then((e=>{$.material.envMapInfo.updateFrom(e)})),t=new o.Group,n=new o.Box3,{scene:i}=await(new q.GLTFLoader).setMeshoptDecoder(W.MeshoptDecoder).loadAsync("https://raw.githubusercontent.com/gkjohnson/3d-demo-data/main/models/mercury-about-to-kill-argos/scene.glb");i.traverse((e=>{e.material&&(e.material.map=null)})),i.scale.setScalar(.01),i.position.x=.05,i.updateMatrixWorld(!0),n.setFromObject(i),i.position.y-=n.min.y,t.add(i);const d=new o.CylinderBufferGeometry(3.5,3.5,.05,60),p=new o.MeshPhysicalMaterial({color:new o.Color(10066329),metalness:.2,roughness:.02}),m=new o.Mesh(d,p);m.position.y=-.025,t.add(m),t.updateMatrixWorld();const u=new o.RectAreaLight(new o.Color(16777215),5,1,1);u.position.x=1.5,u.position.y=1,u.position.z=-.5,u.rotateZ(-Math.PI/4),u.rotateX(-Math.PI/2),t.add(u);const w=new o.RectAreaLight(new o.Color(16711680),15,1.25,2.75);w.position.y=1.25,w.position.z=-1.5,w.rotateX(Math.PI),t.add(w),U=[u,w],O=new v(J,R.domElement),O.addEventListener("objectChange",(()=>{$.material.lights.updateFrom(U),$.reset()})),O.addEventListener("dragging-changed",(e=>H.enabled=!e.value)),O.attach(u),O.setSize(.5),window.addEventListener("keydown",(function(e){switch(e.key){case"w":O.setMode("translate");break;case"e":O.setMode("rotate")}})),D=new o.Scene,D.add(O);const y=new h.PathTracingSceneWorker,g=y.generate(t,{onProgress(e){te.innerText=`Generating BVH ${(100*e).toFixed(2)}%`}}).then((e=>{N=e;const{bvh:t,textures:n,materials:i,lights:o}=e,a=t.geometry,s=$.material;s.bvh.updateFrom(t),s.normalAttribute.updateFrom(a.attributes.normal),s.tangentAttribute.updateFrom(a.attributes.tangent),s.uvAttribute.updateFrom(a.attributes.uv),s.materialIndexAttribute.updateFrom(a.attributes.materialIndex),s.textures.setTextures(R,2048,2048,n),s.materials.updateFrom(i,n),s.lights.updateFrom(o),s.lightCount=o.length,y.dispose()}));await Promise.all([g,e]),document.getElementById("loading").remove(),oe(),window.addEventListener("resize",oe);const M=new c.GUI;M.add(ne,"controls").onChange((e=>{O.enabled=e,O.visible=e}));const b=M.addFolder("Path Tracing");b.add(ne,"tiles",1,4,1).onChange((e=>{$.tiles.set(e,e)})),b.add(ne,"samplesPerFrame",1,10,1),b.add(ne,"filterGlossyFactor",0,1).onChange((()=>{$.reset()})),b.add(ne,"bounces",1,15,1).onChange((()=>{$.reset()})),b.add(ne,"resolutionScale",.1,1).onChange((()=>{oe()})),b.add(ne,"multipleImportanceSampling").onChange((()=>{$.material.defines.FEATURE_MIS=ne.multipleImportanceSampling?1:0,$.material.needsUpdate=!0,$.reset()})),b.close();const x=M.addFolder("Environment");x.add(ne,"environmentIntensity",0,3).onChange((()=>{$.reset()})),x.add(ne,"environmentRotation",0,2*Math.PI).onChange((e=>{$.material.environmentRotation.setFromMatrix4((new o.Matrix4).makeRotationY(e)),$.reset()})),x.close();const f=M.addFolder("Area Light 1");f.add(ne,"areaLight1Enabled").name("enable").onChange(ie),f.add(ne,"areaLight1Intensity",0,200).name("intensity").onChange(ie),f.addColor(ne,"areaLight1Color").name("color").onChange(ie),f.add(ne,"areaLight1Width",0,5).name("width").onChange(ie),f.add(ne,"areaLight1Height",0,5).name("height").onChange(ie);const P=M.addFolder("Area Light 2");P.add(ne,"areaLight2Enabled").name("enable").onChange(ie),P.add(ne,"areaLight2Intensity",0,200).name("intensity").onChange(ie),P.addColor(ne,"areaLight2Color").name("color").onChange(ie),P.add(ne,"areaLight2Width",0,5).name("width").onChange(ie),P.add(ne,"areaLight2Height",0,5).name("height").onChange(ie),ie(),ae()}();
//# sourceMappingURL=areaLight.aaa9b5da.js.map
