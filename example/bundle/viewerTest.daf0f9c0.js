var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},t={},n={},a=e.parcelRequire5b70;null==a&&((a=function(e){if(e in t)return t[e].exports;if(e in n){var a=n[e];delete n[e];var i={id:e,exports:{}};return t[e]=i,a.call(i.exports,i,i.exports),i.exports}var o=new Error("Cannot find module '"+e+"'");throw o.code="MODULE_NOT_FOUND",o}).register=function(e,t){n[e]=t},e.parcelRequire5b70=a);var i=a("ilwiq"),o=a("kp7Te"),r=a("891vQ"),l=a("7lx9d"),s=a("jiuw3"),d=function(){var e=0,t=document.createElement("div");function n(e){return t.appendChild(e.dom),e}function a(n){for(var a=0;a<t.children.length;a++)t.children[a].style.display=a===n?"block":"none";e=n}t.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",t.addEventListener("click",(function(n){n.preventDefault(),a(++e%t.children.length)}),!1);var i=(performance||Date).now(),o=i,r=0,l=n(new d.Panel("FPS","#0ff","#002")),s=n(new d.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=n(new d.Panel("MB","#f08","#201"));return a(0),{REVISION:16,dom:t,addPanel:n,showPanel:a,begin:function(){i=(performance||Date).now()},end:function(){r++;var e=(performance||Date).now();if(s.update(e-i,200),e>=o+1e3&&(l.update(1e3*r/(e-o),100),o=e,r=0,c)){var t=performance.memory;c.update(t.usedJSHeapSize/1048576,t.jsHeapSizeLimit/1048576)}return e},update:function(){i=this.end()},domElement:t,setMode:a}};d.Panel=function(e,t,n){var a=1/0,i=0,o=Math.round,r=o(window.devicePixelRatio||1),l=80*r,s=48*r,d=3*r,c=2*r,m=3*r,p=15*r,u=74*r,g=30*r,h=document.createElement("canvas");h.width=l,h.height=s,h.style.cssText="width:80px;height:48px";var f=h.getContext("2d");return f.font="bold "+9*r+"px Helvetica,Arial,sans-serif",f.textBaseline="top",f.fillStyle=n,f.fillRect(0,0,l,s),f.fillStyle=t,f.fillText(e,d,c),f.fillRect(m,p,u,g),f.fillStyle=n,f.globalAlpha=.9,f.fillRect(m,p,u,g),{dom:h,update:function(s,y){a=Math.min(a,s),i=Math.max(i,s),f.fillStyle=n,f.globalAlpha=1,f.fillRect(0,0,l,p),f.fillStyle=t,f.fillText(o(s)+" "+e+" ("+o(a)+"-"+o(i)+")",d,c),f.drawImage(h,m+r,p,u-r,g,m,p,u-r,g),f.fillRect(m+u-r,p,r,g),f.fillStyle=n,f.globalAlpha=.9,f.fillRect(m+u-r,p,r,o((1-s/y)*g))}}};var c=d,m=a("cVdfP"),p=a("4CEV9"),u=a("RPVlj"),g=a("5Rd1x");const h="https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config/",f=new URLSearchParams(window.location.search),y=parseInt(f.get("samples"))||-1,w="true"===f.get("hideUI"),b=parseInt(f.get("tiles"))||2,v={environmentIntensity:1,multipleImportanceSampling:!0,acesToneMapping:!0,tilesX:b,tilesY:b,samplesPerFrame:1,scale:1/window.devicePixelRatio,model:"",checkerboardTransparency:!0,enable:!0,bounces:10,pause:!1,imageMode:"hidden",imageOpacity:.5,imageType:"dspbr-pt"};let x,M,T,S,E,F,R,C,P,I,k,L,A,D,O,B=!1,j=0;function U(){if(requestAnimationFrame(U),!(k.samples>=y&&-1!==y||(R.update(),E.style.display="hidden"===v.imageMode?"none":"inline-block",E.style.opacity="side-by-side"===v.imageMode?1:v.imageOpacity,E.style.position="side-by-side"===v.imageMode?"initial":"absolute",E.style.width=P.domElement.style.width,E.style.height=P.domElement.style.height,B))){if((k.samples<1||!v.enable)&&P.render(D,I),v.enable&&0===j){const e=Math.floor(k.samples);if(T.innerText=`samples: ${e}`,k.material.materials.updateFrom(C.materials,C.textures),k.material.filterGlossyFactor=.5,k.material.bounces=v.bounces,k.material.physicalCamera.updateFrom(I),k.material.environmentIntensity=v.environmentIntensity,I.updateMatrixWorld(),!v.pause||k.samples<1)for(let e=0,t=v.samplesPerFrame;e<t;e++)k.update();P.autoClear=!1,L.render(P),P.autoClear=!0}else j>0&&j--;k.samples>=y&&-1!==y&&requestAnimationFrame((()=>{window.dispatchEvent(new Event("render-complete"))})),T.innerText=`Samples: ${Math.floor(k.samples)}`}}function z(){v.tilesX*v.tilesY!=1&&(j=1),k.reset()}async function G(){let e,t;F&&(S.classList.remove("checkerboard"),F.destroy(),F=null);const n=new i.LoadingManager,a=O[v.model];window.location.hash=v.model;let{orbit:d={},target:c={},dimensions:u={}}=a;const{verticalFoV:g=45,renderSkybox:f=!1,lighting:y="../../../shared-assets/environments/lightroom_14b.hdr"}=a;d=Object.assign({},{theta:0,phi:90,radius:1},d),c=Object.assign({},{x:0,y:0,z:0},c),u=Object.assign({},{width:768,height:768},u),d.radius=Math.max(d.radius,1e-5),B=!0,S.style.display="none",T.innerText="--",x.innerText="--",M.innerText="Loading",M.style.visibility="visible",q(),D.traverse((e=>{if(e.material){const t=e.material;for(const e in t)t[e]&&t[e].isTexture&&t[e].dispose()}})),C&&D.remove(C.scene);let b=new URL(a.model,h).toString();b=b.replace(/.*?glTF-Sample-Models/,"https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master"),n.onLoad=async()=>{(new p.MaterialReducer).process(e),e.updateMatrixWorld();const n=new m.PathTracingSceneWorker,o=await n.generate(e,{onProgress:e=>{const t=Math.floor(100*e);M.innerText=`Building BVH : ${t}%`}});C=o,D.add(C.scene);const{bvh:r,textures:l,materials:h}=o,y=r.geometry,b=k.material;b.bvh.updateFrom(r),b.normalAttribute.updateFrom(y.attributes.normal),b.tangentAttribute.updateFrom(y.attributes.tangent),b.uvAttribute.updateFrom(y.attributes.uv),b.materialIndexAttribute.updateFrom(y.attributes.materialIndex),b.textures.setTextures(P,2048,2048,l),b.materials.updateFrom(h,l),b.envMapInfo.updateFrom(t),n.dispose(),t.mapping=i.EquirectangularReflectionMapping,D.environment=t,D.background=t,M.style.visibility="hidden",x.innerHTML=a.credit||"",x.style.visibility=a.credit?"visible":"hidden",function(){if(w)return;F&&F.destroy(),F=new s.GUI,F.add(v,"model",Object.keys(O)).onChange(G);const e=F.addFolder("path tracing");e.add(v,"enable"),e.add(v,"pause"),e.add(v,"scale",0,1).onChange((e=>{const t=window.devicePixelRatio;let{dimensions:n={}}=O[v.model];n=Object.assign({},{width:768,height:768},n);const{width:a,height:i}=n;k.setSize(a*t*e,i*t*e),k.reset()})),e.add(v,"multipleImportanceSampling").onChange((e=>{k.material.setDefine("FEATURE_MIS",Number(e)),k.reset()})),e.add(v,"acesToneMapping").onChange((e=>{P.toneMapping=e?i.ACESFilmicToneMapping:i.NoToneMapping})),e.add(v,"bounces",1,20,1).onChange((()=>{k.reset()})),e.add(v,"environmentIntensity",0,5).onChange((()=>{k.reset()}));const t=F.addFolder("comparison");t.add(v,"imageMode",["hidden","overlay","side-by-side"]),t.add(v,"imageType",["dspbr-pt","filament","babylon","gltf-sample-viewer","model-viewer","rhodonite","stellar"]).onChange(q),t.add(v,"imageOpacity",0,1);const n=F.addFolder("resolution");n.add(v,"samplesPerFrame",1,10,1),n.add(v,"tilesX",1,10,1).onChange((e=>{k.tiles.x=e})),n.add(v,"tilesY",1,10,1).onChange((e=>{k.tiles.y=e})),n.open(),F.addFolder("background").add(v,"checkerboardTransparency").onChange((e=>{e?S.classList.add("checkerboard"):S.classList.remove("checkerboard")}))}(),I.position.setFromSphericalCoords(d.radius,i.MathUtils.DEG2RAD*d.phi,i.MathUtils.DEG2RAD*d.theta),I.position.x+=c.x,I.position.y+=c.y,I.position.z+=c.z;const T=window.devicePixelRatio,{width:E,height:R}=u;P.setSize(E,R),P.setPixelRatio(T),k.setSize(E*T*v.scale,R*T*v.scale),I.aspect=E/R,I.fov=g,I.updateProjectionMatrix(),A.target.set(c.x,c.y,c.z),A.update(),I.updateMatrixWorld(),k.material.backgroundAlpha=f?1:0,k.reset(),S.style.display="flex",B=!1,v.checkerboardTransparency&&S.classList.add("checkerboard")};const E=new URL(y,h).toString();new r.RGBELoader(n).load(E,(e=>{t=e})),new l.GLTFLoader(n).setMeshoptDecoder(o.MeshoptDecoder).load(b,(t=>{e=t.scene}),(e=>{if(0!==e.total&&e.total>=e.loaded){const t=Math.floor(100*e.loaded/e.total);M.innerText=`Loading : ${t}%`}}))}function q(){E.src=`https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/goldens/${v.model}/${v.imageType}-golden.png`}!async function(){x=document.getElementById("credits"),M=document.getElementById("loading"),T=document.getElementById("samples"),S=document.getElementById("container"),E=document.querySelector("img"),w&&(S.style.background="transparent",document.body.style.background="transparent");P=new i.WebGLRenderer({antialias:!0}),P.outputEncoding=i.sRGBEncoding,P.toneMapping=i.ACESFilmicToneMapping,P.physicallyCorrectLights=!0,S.appendChild(P.domElement),D=new i.Scene;const e=window.innerWidth/window.innerHeight;I=new i.PerspectiveCamera(60,e,.01,500),I.position.set(-1,.25,1),k=new p.PathTracingRenderer(P),k.camera=I,k.alpha=!0,k.material=new p.PhysicalPathTracingMaterial,k.tiles.set(v.tiles,v.tiles),k.material.setDefine("FEATURE_MIS",Number(v.multipleImportanceSampling)),k.tiles.set(v.tilesX,v.tilesY),L=new u.FullScreenQuad(new i.MeshBasicMaterial({map:k.target.texture,blending:i.CustomBlending})),A=new g.OrbitControls(I,S),A.addEventListener("change",z),R=new c,w?(x.remove(),T.remove()):S.appendChild(R.dom);const{scenarios:t}=await(await fetch("https://raw.githubusercontent.com/google/model-viewer/master/packages/render-fidelity-tools/test/config.json")).json();O={},t.forEach((e=>{O[e.name]=e}));let n=t[0].name;if(window.location.hash){const e=window.location.hash.substring(1).replaceAll("%20"," ");e in O&&(n=e)}v.model=n,G(),U()}();
//# sourceMappingURL=viewerTest.daf0f9c0.js.map
