{"mappings":"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","sources":["node_modules/@parcel/runtime-js/lib/helpers/bundle-manifest.js","src/workers/PathTracingSceneWorker.js","src/core/PathTracingSceneGenerator.js","node_modules/three-mesh-bvh/src/workers/GenerateMeshBVHWorker.js","node_modules/@parcel/runtime-js/lib/runtime-fcae82002fa0f25d.js","node_modules/@parcel/runtime-js/lib/helpers/get-worker-url.js","node_modules/@parcel/runtime-js/lib/runtime-5285bda963f69e60.js"],"sourcesContent":["\"use strict\";\n\nvar mapping = {};\n\nfunction register(pairs) {\n  var keys = Object.keys(pairs);\n\n  for (var i = 0; i < keys.length; i++) {\n    mapping[keys[i]] = pairs[keys[i]];\n  }\n}\n\nfunction resolve(id) {\n  var resolved = mapping[id];\n\n  if (resolved == null) {\n    throw new Error('Could not resolve bundle with id ' + id);\n  }\n\n  return resolved;\n}\n\nmodule.exports.register = register;\nmodule.exports.resolve = resolve;","import { PathTracingSceneGenerator } from '../core/PathTracingSceneGenerator.js';\nimport { SAH } from 'three-mesh-bvh';\nimport { GenerateMeshBVHWorker } from 'three-mesh-bvh/src/workers/GenerateMeshBVHWorker.js';\n\nexport class PathTracingSceneWorker extends PathTracingSceneGenerator {\n\n\tconstructor() {\n\n\t\tsuper();\n\t\tthis.bvhGenerator = new GenerateMeshBVHWorker();\n\n\t}\n\n\tgenerate( scene, options = {} ) {\n\n\t\tconst { bvhGenerator } = this;\n\t\tconst { geometry, materials, textures, lights } = this.prepScene( scene );\n\n\t\tconst bvhOptions = { strategy: SAH, ...options, maxLeafTris: 1 };\n\t\tconst bvhPromise = bvhGenerator.generate( geometry, bvhOptions );\n\t\treturn bvhPromise.then( bvh => {\n\n\t\t\treturn {\n\t\t\t\tscene,\n\t\t\t\tmaterials,\n\t\t\t\ttextures,\n\t\t\t\tlights,\n\t\t\t\tbvh,\n\t\t\t};\n\n\t\t} );\n\n\t}\n\n\tdispose() {\n\n\t\tthis.bvhGenerator.dispose();\n\n\t}\n\n}\n","import { Mesh } from 'three';\nimport { SAH, MeshBVH, StaticGeometryGenerator } from 'three-mesh-bvh';\nimport { mergeMeshes } from '../utils/GeometryPreparationUtils.js';\n\nexport class PathTracingSceneGenerator {\n\n\tprepScene( scene ) {\n\n\t\tscene = Array.isArray( scene ) ? scene : [ scene ];\n\n\t\tconst meshes = [];\n\t\tconst lights = [];\n\n\t\tfor ( let i = 0, l = scene.length; i < l; i ++ ) {\n\n\t\t\tscene[ i ].traverse( c => {\n\n\t\t\t\tif ( c.isSkinnedMesh || c.isMesh && c.morphTargetInfluences ) {\n\n\t\t\t\t\tconst generator = new StaticGeometryGenerator( c );\n\t\t\t\t\tgenerator.applyWorldTransforms = false;\n\t\t\t\t\tconst mesh = new Mesh(\n\t\t\t\t\t\tgenerator.generate(),\n\t\t\t\t\t\tc.material,\n\t\t\t\t\t);\n\t\t\t\t\tmesh.matrixWorld.copy( c.matrixWorld );\n\t\t\t\t\tmesh.matrix.copy( c.matrixWorld );\n\t\t\t\t\tmesh.matrix.decompose( mesh.position, mesh.quaternion, mesh.scale );\n\t\t\t\t\tmeshes.push( mesh );\n\n\t\t\t\t} else if ( c.isMesh ) {\n\n\t\t\t\t\tmeshes.push( c );\n\n\t\t\t\t} else if ( c.isRectAreaLight ) {\n\n\t\t\t\t\tlights.push( c );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t}\n\n\t\treturn {\n\t\t\t...mergeMeshes( meshes, {\n\t\t\t\tattributes: [ 'position', 'normal', 'tangent', 'uv' ],\n\t\t\t} ),\n\t\t\tlights\n\t\t};\n\n\t}\n\n\tgenerate( scene, options = {} ) {\n\n\t\tconst { materials, textures, geometry, lights } = this.prepScene( scene );\n\t\tconst bvhOptions = { strategy: SAH, ...options, maxLeafTris: 1 };\n\t\treturn {\n\t\t\tscene,\n\t\t\tmaterials,\n\t\t\ttextures,\n\t\t\tlights,\n\t\t\tbvh: new MeshBVH( geometry, bvhOptions ),\n\t\t};\n\n\t}\n\n}\n","import { Box3, BufferAttribute } from 'three';\r\nimport { MeshBVH } from '../core/MeshBVH.js';\r\n\r\nexport class GenerateMeshBVHWorker {\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.running = false;\r\n\t\tthis.worker = new Worker( new URL( './generateAsync.worker.js', import.meta.url ), { type: 'module' } );\r\n\r\n\t}\r\n\r\n\tgenerate( geometry, options = {} ) {\r\n\r\n\t\tif ( this.running ) {\r\n\r\n\t\t\tthrow new Error( 'GenerateMeshBVHWorker: Already running job.' );\r\n\r\n\t\t}\r\n\r\n\t\tconst { worker } = this;\r\n\t\tthis.running = true;\r\n\r\n\t\treturn new Promise( ( resolve, reject ) => {\r\n\r\n\t\t\tworker.onmessage = e => {\r\n\r\n\t\t\t\tthis.running = false;\r\n\t\t\t\tconst { data } = e;\r\n\r\n\t\t\t\tif ( data.error ) {\r\n\r\n\t\t\t\t\treject( new Error( data.error ) );\r\n\t\t\t\t\tworker.onmessage = null;\r\n\r\n\t\t\t\t} else if ( data.serialized ) {\r\n\r\n\t\t\t\t\tconst { serialized, position } = data;\r\n\t\t\t\t\tconst bvh = MeshBVH.deserialize( serialized, geometry, { setIndex: false } );\r\n\t\t\t\t\tconst boundsOptions = Object.assign( {\r\n\r\n\t\t\t\t\t\tsetBoundingBox: true,\r\n\r\n\t\t\t\t\t}, options );\r\n\r\n\t\t\t\t\t// we need to replace the arrays because they're neutered entirely by the\r\n\t\t\t\t\t// webworker transfer.\r\n\t\t\t\t\tgeometry.attributes.position.array = position;\r\n\t\t\t\t\tif ( geometry.index ) {\r\n\r\n\t\t\t\t\t\tgeometry.index.array = serialized.index;\r\n\r\n\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\tconst newIndex = new BufferAttribute( serialized.index, 1, false );\r\n\t\t\t\t\t\tgeometry.setIndex( newIndex );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif ( boundsOptions.setBoundingBox ) {\r\n\r\n\t\t\t\t\t\tgeometry.boundingBox = bvh.getBoundingBox( new Box3() );\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tresolve( bvh );\r\n\t\t\t\t\tworker.onmessage = null;\r\n\r\n\t\t\t\t} else if ( options.onProgress ) {\r\n\r\n\t\t\t\t\toptions.onProgress( data.progress );\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t};\r\n\r\n\t\t\tconst index = geometry.index ? geometry.index.array : null;\r\n\t\t\tconst position = geometry.attributes.position.array;\r\n\r\n\t\t\tif ( position.isInterleavedBufferAttribute || index && index.isInterleavedBufferAttribute ) {\r\n\r\n\t\t\t\tthrow new Error( 'GenerateMeshBVHWorker: InterleavedBufferAttribute are not supported for the geometry attributes.' );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tconst transferrables = [ position ];\r\n\t\t\tif ( index ) {\r\n\r\n\t\t\t\ttransferrables.push( index );\r\n\r\n\t\t\t}\r\n\r\n\t\t\tworker.postMessage( {\r\n\r\n\t\t\t\tindex,\r\n\t\t\t\tposition,\r\n\t\t\t\toptions: {\r\n\t\t\t\t\t...options,\r\n\t\t\t\t\tonProgress: null,\r\n\t\t\t\t\tincludedProgressCallback: Boolean( options.onProgress ),\r\n\t\t\t\t\tgroups: [ ... geometry.groups ],\r\n\t\t\t\t},\r\n\r\n\t\t\t}, transferrables.map( arr => arr.buffer ) );\r\n\r\n\t\t} );\r\n\r\n\t}\r\n\r\n\tdispose() {\r\n\r\n\t\tthis.worker.terminate();\r\n\r\n\t}\r\n\r\n\tterminate() {\r\n\r\n\t\tconsole.warn( 'GenerateMeshBVHWorker: \"terminate\" is deprecated. Use \"dispose\" instead.' );\r\n\t\tthis.dispose();\r\n\r\n\t}\r\n\r\n}\r\n","let workerURL = require('./helpers/get-worker-url');\nlet url = new __parcel__URL__(require('./helpers/bundle-manifest').resolve(\"jsyN8\"));\nmodule.exports = workerURL(url.toString(), url.origin, true);","\"use strict\";\n\nmodule.exports = function (workerUrl, origin, isESM) {\n  if (origin === self.location.origin) {\n    // If the worker bundle's url is on the same origin as the document,\n    // use the worker bundle's own url.\n    return workerUrl;\n  } else {\n    // Otherwise, create a blob URL which loads the worker bundle with `importScripts`.\n    var source = isESM ? 'import ' + JSON.stringify(workerUrl) + ';' : 'importScripts(' + JSON.stringify(workerUrl) + ');';\n    return URL.createObjectURL(new Blob([source], {\n      type: 'application/javascript'\n    }));\n  }\n};","require('./helpers/bundle-manifest').register(JSON.parse(\"{\\\"2LzAg\\\":\\\"aoRender.d56c7554.js\\\",\\\"jsyN8\\\":\\\"generateAsync.worker.b2811d07.js\\\"}\"));"],"names":["$18c11f3350a906ea$export$6503ec6e8aabbaf","$18c11f3350a906ea$export$f7ad0328861e2f03","$18c11f3350a906ea$var$mapping","pairs","keys","Object","i","length","id","resolved","Error","$hWj76","parcelRequire","$968516f0efc273ba$export$5499aeafc5a5667b","PathTracingSceneGenerator","constructor","super","this","bvhGenerator","$a8VBx","GenerateMeshBVHWorker","generate","scene","options","geometry","materials","textures","lights","prepScene","bvhOptions","strategy","$8Zfx2","SAH","maxLeafTris","then","bvh","dispose","$ilwiq","$d0f6adfc7402c638$export$245b5237bb7038ea","Array","isArray","meshes","l","traverse","c","isSkinnedMesh","isMesh","morphTargetInfluences","generator","StaticGeometryGenerator","applyWorldTransforms","mesh","Mesh","material","matrixWorld","copy","matrix","decompose","position","quaternion","scale","push","isRectAreaLight","$jM3IF","mergeMeshes","attributes","MeshBVH","$762755cd5891d020$export$426cc6213ad628cf","running","worker","Worker","Promise","resolve","reject","onmessage","e","data","error","serialized","$6KVZ3","deserialize","setIndex","boundsOptions","assign","setBoundingBox","array","index","newIndex","BufferAttribute","boundingBox","getBoundingBox","Box3","onProgress","progress","position1","isInterleavedBufferAttribute","transferrables","postMessage","includedProgressCallback","Boolean","groups","map","arr","buffer","terminate","console","warn","$7ryUf","$1e199522c06e4b04$var$url","URL","import","meta","url","module","exports","toString","origin","workerUrl","isESM","self","location","source","JSON","stringify","createObjectURL","Blob","type","register","parse"],"version":3,"file":"aoRender.d56c7554.js.map"}